# autogenerated file; do not edit
language: c

addons:
 postgresql: 10
 apt:
  packages:
   - php-cli
   - php-pear
   - valgrind

cache:
 directories:
  - $HOME/cache

before_cache:
 - find $HOME/cache -name '*.gcda' -o -name '*.gcno' -delete

env:
 global:
  - PQ_DSN="postgres://postgres@localhost/test"
 matrix:
  - PHP=7.0 enable_debug=yes enable_maintainer_zts=yes enable_json=yes
  - PHP=7.1 enable_debug=yes enable_maintainer_zts=yes enable_json=yes
  - PHP=7.2 enable_debug=yes enable_maintainer_zts=yes enable_json=yes
  - PHP=7.3 enable_debug=yes enable_maintainer_zts=yes enable_json=yes
  - PHP=7.4 enable_debug=yes enable_maintainer_zts=yes enable_json=yes
  - PHP=master enable_debug=yes enable_zts=yes enable_json=yes
  - PHP=8.0 enable_json=no
  - PHP=8.0 enable_json=yes enable_debug=no enable_zts=no
  - PHP=8.0 enable_json=yes enable_debug=yes enable_zts=no
  - PHP=8.0 enable_json=yes enable_debug=no enable_zts=yes
  - PHP=8.0 enable_json=yes enable_debug=yes enable_zts=yes
  - PHP=8.0 enable_json=yes CFLAGS='-O0 -g --coverage' CXXFLAGS='-O0 -g --coverage'

matrix:
 fast_finish: true
 allow_failures:
  - env: PHP=master enable_debug=yes enable_zts=yes enable_json=yes

install:
 - |
   if test "$PHP" = master; then \
     make -f travis/pecl/Makefile reconf; \
     make -f travis/pecl/Makefile pecl-rm pecl-clean PECL=raphf:raphf:2.0.0; \
   fi
 - make -f travis/pecl/Makefile php || make -f travis/pecl/Makefile clean php
 - make -f travis/pecl/Makefile pecl PECL=raphf:raphf:2.0.0

before_script:
 - psql -U postgres -c "CREATE DATABASE test"

script:
 - make -f travis/pecl/Makefile ext PECL=pq
 - make -f travis/pecl/Makefile test

after_success:
 - test -n "$CFLAGS" && cd src/.libs && bash <(curl -s https://codecov.io/bash) -X xcode -X coveragepy
